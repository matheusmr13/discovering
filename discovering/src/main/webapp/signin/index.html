<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
	<div class="login-wrapper" style="display:none;">
		<div>
			<h1>Sign in</h1>
			<input type="text" name="login" />
			<input type="password" name="password" />
			<button id="login">Login</button>
			<hr/>
			<button id="google-login">Login with Google</button>
		</div>
	</div>
	<script type="text/javascript" src="/js/lib/jquery-2.1.4.js" charset="utf-8"></script>
	<script type="text/javascript" src="/js/lib/toastr.js" charset="utf-8"></script>
	<script>
		$(document).ready(function () {
			$.getJSON('/discovering/api/usuarios/me').done(function (me) {
				window.location = ['COMISSAO', 'FORMANDO'].indexOf(me.perfil) !== -1 ? '/formando/' : '/turing';
			}).fail(function () {
				$('.login-wrapper').show();

				$('#google-login').click(function () {
					$.ajax({
						type: 'GET',
						url: '/authEmail/loginUrl'
					}).done(function (url) {
						window.location = url;
					});

					return false;
				});

				$('input[name="login"], input[name="password"]').keypress(function (e) {
					if (e.keyCode === 13) {
						$('#login').click();
					}
				});

				$('#login').click(function () {
					$.ajax({
						type: 'PUT',
						url: '/discovering/auth',
						data: {
							email: $('#email-login').val(),
							senha: $('#password-login').val()
						}
					}).done(function () {
						window.location = '/formando';
					}).fail(function (e) {
						toastr.error(e.responseText);
						$('[name=email]').focus();
					});
				});

				if (window.location.hash === '#email-invalido') {
					toastr.error('Acesso negado para essa conta de e-mail');
					window.location.hash = '';
				}
			});
		});
	</script>
</body>

</html>